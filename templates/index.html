{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Status message placeholder -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="reformulation-tab" data-bs-toggle="tab" data-bs-target="#reformulation" type="button" role="tab">
                Reformulation
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="translation-tab" data-bs-toggle="tab" data-bs-target="#translation" type="button" role="tab">
                Traduction
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="email-tab" data-bs-toggle="tab" data-bs-target="#email" type="button" role="tab">
                Email
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="history-tab" data-bs-toggle="tab" data-bs-target="#history" type="button" role="tab">
                Historique
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button" role="tab">
                Configuration
            </button>
        </li>
    </ul>

    <div class="tab-content">
        <!-- Reformulation Tab -->
        <div class="tab-pane fade show active" id="reformulation" role="tabpanel">
            <div class="row">
                <!-- Context Section -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5>Contexte (optionnel)</h5>
                            <textarea id="contextText" class="form-control mb-3" rows="3" placeholder="Entrez le contexte..."></textarea>
                            <div class="text-muted">
                                <small>
                                    Caractères: <span id="contextCharCount">0</span> |
                                    Mots: <span id="contextWordCount">0</span> |
                                    Paragraphes: <span id="contextParaCount">0</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Input Section -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5>Texte à reformuler</h5>
                            <textarea id="inputText" class="form-control mb-3" rows="3" placeholder="Entrez votre texte..."></textarea>
                            <div class="text-muted">
                                <small>
                                    Caractères: <span id="inputCharCount">0</span> |
                                    Mots: <span id="inputWordCount">0</span> |
                                    Paragraphes: <span id="inputParaCount">0</span>
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Formatting Options -->
            <div class="card mb-4">
                <div class="card-body">
                    <h5>Options de reformulation</h5>
                    
                    <!-- Tone Options -->
                    <div id="toneGroup" class="btn-group mb-3">
                        <button type="button" class="btn btn-outline-secondary active" data-value="Professional">Professionnel</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Casual">Décontracté</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Academic">Académique</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Creative">Créatif</button>
                    </div>

                    <!-- Format Options -->
                    <div id="formatGroup" class="btn-group mb-3">
                        <button type="button" class="btn btn-outline-secondary active" data-value="Paragraph">Paragraphe</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Bullet">Liste à puces</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Numbered">Liste numérotée</button>
                    </div>

                    <!-- Length Options -->
                    <div id="lengthGroup" class="btn-group">
                        <button type="button" class="btn btn-outline-secondary" data-value="Shorter">Plus court</button>
                        <button type="button" class="btn btn-outline-secondary active" data-value="Similar">Similaire</button>
                        <button type="button" class="btn btn-outline-secondary" data-value="Longer">Plus long</button>
                    </div>
                </div>
            </div>

            <!-- Output Section -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Texte reformulé</h5>
                        <div>
                            <button id="reformulateBtn" class="btn btn-success me-2">Reformuler</button>
                            <button id="copyBtn" class="btn btn-outline-secondary me-2">Copier</button>
                            <button id="clearBtn" class="btn btn-outline-secondary">Effacer</button>
                        </div>
                    </div>
                    <textarea id="outputText" class="form-control mb-3" rows="6" readonly></textarea>
                    <div class="text-muted">
                        <small>
                            Caractères: <span id="outputCharCount">0</span> |
                            Mots: <span id="outputWordCount">0</span> |
                            Paragraphes: <span id="outputParaCount">0</span>
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation Tab -->
        <div class="tab-pane fade" id="translation" role="tabpanel">
            <div class="card mb-4">
                <div class="card-body">
                    <h5>Traduction</h5>
                    <button type="button" class="btn btn-outline-secondary mb-3" data-bs-toggle="modal" data-bs-target="#translationModal">
                        Ouvrir la traduction
                    </button>
                </div>
            </div>
        </div>

        <!-- Email Tab -->
        <div class="tab-pane fade" id="email" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <h5>Générateur d'emails</h5>
                    <div class="mb-3">
                        <label for="emailType" class="form-label">Type d'email</label>
                        <select id="emailType" class="form-select">
                            <option value="demande">Demande</option>
                            <option value="reponse">Réponse</option>
                            <option value="suivi">Suivi</option>
                            <option value="information">Information</option>
                            <option value="reclamation">Réclamation</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="emailContent" class="form-label">Contenu/contexte</label>
                        <textarea id="emailContent" class="form-control" rows="4" placeholder="Décrivez le contenu ou le contexte de l'email..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="emailSender" class="form-label">Signature (optionnel)</label>
                        <input type="text" id="emailSender" class="form-control" placeholder="Votre nom et fonction">
                    </div>
                    <div class="mb-3">
                        <button id="generateEmail" class="btn btn-success">Générer l'email</button>
                        <button id="clearEmail" class="btn btn-outline-secondary">Effacer</button>
                    </div>
                    <div class="mb-3">
                        <label for="emailSubject" class="form-label">Objet</label>
                        <div class="input-group">
                            <input type="text" id="emailSubject" class="form-control" readonly>
                            <button id="copyEmailSubject" class="btn btn-outline-secondary">Copier</button>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="emailOutput" class="form-label">Email généré</label>
                        <div class="input-group">
                            <textarea id="emailOutput" class="form-control" rows="8" readonly></textarea>
                            <button id="copyEmail" class="btn btn-outline-secondary">Copier</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div class="tab-pane fade" id="history" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0">Historique des reformulations</h5>
                        <button id="clearHistory" class="btn btn-outline-danger">Effacer l'historique</button>
                    </div>
                    {% if history %}
                        <div class="accordion" id="historyAccordion">
                            {% for item in history %}
                            <div class="accordion-item">
                                <h2 class="accordion-header">
                                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#history{{ item.id }}">
                                        {{ item.created_at }}
                                    </button>
                                </h2>
                                <div id="history{{ item.id }}" class="accordion-collapse collapse" data-bs-parent="#historyAccordion">
                                    <div class="accordion-body">
                                        {% if item.context %}
                                        <div class="mb-3">
                                            <strong>Contexte:</strong>
                                            <p>{{ item.context }}</p>
                                        </div>
                                        {% endif %}
                                        <div class="mb-3">
                                            <strong>Texte original:</strong>
                                            <p>{{ item.original_text }}</p>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Texte reformulé:</strong>
                                            <p>{{ item.reformulated_text }}</p>
                                        </div>
                                        <div class="mb-3">
                                            <strong>Options:</strong>
                                            <p>
                                                Ton: {{ item.tone }} |
                                                Format: {{ item.format }} |
                                                Longueur: {{ item.length }}
                                            </p>
                                        </div>
                                        <button class="btn btn-success btn-sm reuse-history" 
                                                data-context="{{ item.context }}"
                                                data-text="{{ item.original_text }}"
                                                data-tone="{{ item.tone }}"
                                                data-format="{{ item.format }}"
                                                data-length="{{ item.length }}">
                                            Réutiliser
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted">Aucun historique disponible.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div class="tab-pane fade" id="config" role="tabpanel">
            <div class="card">
                <div class="card-body">
                    <h5>Configuration</h5>
                    <div class="mb-3">
                        <label class="form-label">Fournisseur d'IA</label>
                        <select id="aiProvider" class="form-select">
                            <option value="ollama">Ollama (Local)</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="groq">Groq</option>
                        </select>
                    </div>

                    <!-- Ollama Configuration -->
                    <div id="ollamaConfig" class="provider-config">
                        <div class="mb-3">
                            <label class="form-label">URL d'Ollama:</label>
                            <input type="text" id="ollamaUrl" class="form-control" value="http://localhost:11434">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="modelSelect" class="form-select"></select>
                        </div>
                        <button id="refreshModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- OpenAI Configuration -->
                    <div id="openaiConfig" class="provider-config" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Clé API:</label>
                            <input type="password" id="openaiKey" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="openaiModel" class="form-select"></select>
                        </div>
                        <button id="refreshOpenaiModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- Anthropic Configuration -->
                    <div id="anthropicConfig" class="provider-config" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Clé API:</label>
                            <input type="password" id="anthropicKey" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="anthropicModel" class="form-select"></select>
                        </div>
                        <button id="refreshAnthropicModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- Gemini Configuration -->
                    <div id="geminiConfig" class="provider-config" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Clé API:</label>
                            <input type="password" id="geminiKey" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="geminiModel" class="form-select"></select>
                        </div>
                        <button id="refreshGeminiModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- Groq Configuration -->
                    <div id="groqConfig" class="provider-config" style="display: none;">
                        <div class="mb-3">
                            <label class="form-label">Clé API:</label>
                            <input type="password" id="groqKey" class="form-control">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="groqModel" class="form-select"></select>
                        </div>
                        <button id="refreshGroqModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- Save Configuration Button -->
                    <button id="saveConfig" class="btn btn-success">Sauvegarder la configuration</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Include Modals -->
{% include 'settings_modal.html' %}
{% include 'prompt_modal.html' %}
{% include 'translation_modal.html' %}
{% endblock %}
