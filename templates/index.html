{% extends "base.html" %}

{% block content %}
<div class="container">
    <!-- Alert container -->
    <div id="alertContainer"></div>

    <!-- Navigation tabs -->
    <ul class="nav nav-tabs mb-4" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#reformulation" type="button">Reformulation</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#translation" type="button">Traduction</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#email" type="button">Email</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#history" type="button">Historique</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#config" type="button">Configuration</button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content">
        <!-- Reformulation Tab -->
        <div class="tab-pane fade show active" id="reformulation">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Contexte (optionnel):</label>
                        <textarea id="contextText" class="form-control" rows="3" placeholder="Ajoutez du contexte pour une meilleure reformulation..."></textarea>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Texte à reformuler:</label>
                        <textarea id="inputText" class="form-control" rows="5" placeholder="Entrez votre texte ici..."></textarea>
                    </div>
                    
                    <!-- Tone Selection -->
                    <div class="mb-3">
                        <label class="form-label">Ton:</label>
                        <div id="toneGroup" class="btn-group">
                            <button class="btn btn-outline-secondary active" data-value="Professionnel">Professionnel</button>
                            <button class="btn btn-outline-secondary" data-value="Informatif">Informatif</button>
                            <button class="btn btn-outline-secondary" data-value="Décontracté">Décontracté</button>
                            <button class="btn btn-outline-secondary" data-value="Enthousiaste">Enthousiaste</button>
                            <button class="btn btn-outline-secondary" data-value="Drôle">Drôle</button>
                            <button class="btn btn-outline-secondary" data-value="Sarcastique">Sarcastique</button>
                        </div>
                    </div>
                    
                    <!-- Format Selection -->
                    <div class="mb-3">
                        <label class="form-label">Format:</label>
                        <div id="formatGroup" class="btn-group">
                            <button class="btn btn-outline-secondary active" data-value="Paragraphe">Paragraphe</button>
                            <button class="btn btn-outline-secondary" data-value="Mail">Mail</button>
                            <button class="btn btn-outline-secondary" data-value="Idées">Idées</button>
                            <button class="btn btn-outline-secondary" data-value="Article">Article de blog</button>
                        </div>
                    </div>
                    
                    <!-- Length Selection -->
                    <div class="mb-3">
                        <label class="form-label">Longueur:</label>
                        <div id="lengthGroup" class="btn-group">
                            <button class="btn btn-outline-secondary active" data-value="Court">Court</button>
                            <button class="btn btn-outline-secondary" data-value="Moyen">Moyen</button>
                            <button class="btn btn-outline-secondary" data-value="Long">Long</button>
                        </div>
                    </div>
                    
                    <button id="reformulateBtn" class="btn btn-success w-100 mb-3">Reformuler</button>
                    
                    <div class="mb-3">
                        <label class="form-label">Résultat:</label>
                        <textarea id="outputText" class="form-control" rows="5" readonly></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button id="copyBtn" class="btn btn-success flex-grow-1">Copier</button>
                        <button id="clearBtn" class="btn btn-secondary flex-grow-1">Effacer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation Tab -->
        <div class="tab-pane fade" id="translation">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Texte à traduire:</label>
                        <textarea id="translationInput" class="form-control" rows="5" placeholder="Entrez votre texte ici..."></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Traduire vers:</label>
                        <select id="targetLanguage" class="form-select">
                            <option value="Anglais">Anglais</option>
                            <option value="Français">Français</option>
                            <option value="Espagnol">Espagnol</option>
                            <option value="Allemand">Allemand</option>
                            <option value="Italien">Italien</option>
                            <option value="Portugais">Portugais</option>
                        </select>
                    </div>
                    
                    <button id="translateText" class="btn btn-success w-100 mb-3">Traduire</button>
                    
                    <div class="mb-3">
                        <label class="form-label">Traduction:</label>
                        <textarea id="translationOutput" class="form-control" rows="5" readonly></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button id="copyTranslation" class="btn btn-success flex-grow-1">Copier</button>
                        <button id="clearTranslation" class="btn btn-secondary flex-grow-1">Effacer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Email Tab -->
        <div class="tab-pane fade" id="email">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Type d'email:</label>
                        <select id="emailType" class="form-select">
                            <option value="Professionnel">Email professionnel</option>
                            <option value="Commercial">Email commercial</option>
                            <option value="Support">Email de support</option>
                            <option value="Suivi">Email de suivi</option>
                            <option value="Demande">Email de demande</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Expéditeur (optionnel):</label>
                        <input type="text" id="emailSender" class="form-control" placeholder="Votre nom ou fonction">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Contenu de l'email:</label>
                        <textarea id="emailContent" class="form-control" rows="5" placeholder="Décrivez le contenu de votre email..."></textarea>
                    </div>
                    
                    <button id="generateEmail" class="btn btn-success w-100 mb-3">Générer l'email</button>
                    
                    <div class="mb-3">
                        <label class="form-label">Objet:</label>
                        <div class="input-group">
                            <input type="text" id="emailSubject" class="form-control" readonly>
                            <button id="copyEmailSubject" class="btn btn-success">Copier</button>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Email généré:</label>
                        <textarea id="emailOutput" class="form-control" rows="5" readonly></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button id="copyEmail" class="btn btn-success flex-grow-1">Copier</button>
                        <button id="clearEmail" class="btn btn-secondary flex-grow-1">Effacer</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div class="tab-pane fade" id="history">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="accordion" id="historyAccordion">
                        {% for item in history %}
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#history{{ item.id }}">
                                    {{ item.created_at|datetime }}
                                </button>
                            </h2>
                            <div id="history{{ item.id }}" class="accordion-collapse collapse" data-bs-parent="#historyAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label class="form-label">Texte original:</label>
                                        <textarea class="form-control" rows="3" readonly>{{ item.original_text }}</textarea>
                                    </div>
                                    {% if item.context %}
                                    <div class="mb-3">
                                        <label class="form-label">Contexte:</label>
                                        <textarea class="form-control" rows="2" readonly>{{ item.context }}</textarea>
                                    </div>
                                    {% endif %}
                                    <div class="mb-3">
                                        <label class="form-label">Texte reformulé:</label>
                                        <textarea class="form-control" rows="3" readonly>{{ item.reformulated_text }}</textarea>
                                    </div>
                                    <div class="d-flex gap-2 small text-muted mb-2">
                                        <span>Ton: {{ item.tone }}</span>
                                        <span>•</span>
                                        <span>Format: {{ item.format }}</span>
                                        <span>•</span>
                                        <span>Longueur: {{ item.length }}</span>
                                    </div>
                                    <button class="btn btn-success btn-sm copy-history" data-text="{{ item.reformulated_text }}">
                                        Copier
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div class="tab-pane fade" id="config">
            <div class="card mb-4">
                <div class="card-body">
                    <h5 class="mb-3">Configuration du Provider</h5>
                    <div class="form-check form-switch mb-3">
                        <input class="form-check-input" type="checkbox" id="useOpenAI" {% if use_openai %}checked{% endif %}>
                        <label class="form-check-label" for="useOpenAI">Utiliser OpenAI</label>
                    </div>
                    
                    <!-- Ollama Configuration -->
                    <div id="ollamaConfig" class="mt-4" {% if use_openai %}style="display: none;"{% endif %}>
                        <h5 class="mb-3">Configuration Ollama</h5>
                        <div class="mb-3">
                            <label class="form-label">URL d'Ollama:</label>
                            <input type="text" id="ollamaUrl" class="form-control" value="{{ ollama_url }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="modelSelect" class="form-select"></select>
                        </div>
                        <button id="refreshModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <!-- OpenAI Configuration -->
                    <div id="openaiConfig" class="mt-4" {% if not use_openai %}style="display: none;"{% endif %}>
                        <h5 class="mb-3">Configuration OpenAI</h5>
                        <div class="mb-3">
                            <label class="form-label">URL de l'API OpenAI:</label>
                            <input type="text" id="openaiUrl" class="form-control" value="{{ openai_url }}">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Clé API OpenAI:</label>
                            <input type="password" id="openaiApiKey" class="form-control" placeholder="sk-...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Modèle:</label>
                            <select id="openaiModelSelect" class="form-select"></select>
                        </div>
                        <button id="refreshOpenAIModels" class="btn btn-success w-100 mb-3">Rafraîchir les modèles</button>
                    </div>

                    <!-- Save Button -->
                    <div class="mt-4">
                        <button id="saveConfig" class="btn btn-success w-100">Sauvegarder la configuration</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
