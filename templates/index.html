{% extends "base.html" %}

{% block content %}
<div class="container">

    <!-- Tab content -->
    <div class="tab-content">
        <!-- Reformulation Tab -->
        <div class="tab-pane fade show active" id="reformulation" role="tabpanel">
            <div class="row g-4">
                <!-- Left Column -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <!-- Texte à reformuler section -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">Texte à reformuler</h5>
                                    <div class="toggle-switch">
                                        <input type="checkbox" id="showContext" class="toggle-switch-checkbox">
                                        <label class="toggle-switch-label" for="showContext">
                                            <span class="toggle-switch-inner"></span>
                                            <span class="toggle-switch-switch"></span>
                                        </label>
                                        <span class="toggle-switch-text">Contexte</span>
                                    </div>
                                </div>

                                <!-- Context Section (Hidden by default) -->
                                <div id="contextSection" style="display: none;">
                                    <div class="textarea-container position-relative mb-3">
                                        <textarea id="contextText" class="form-control" rows="4" placeholder="Collez ici le contexte ou l'email reçu..."></textarea>
                                        <button id="pasteContextText" class="btn paste-button" title="Coller">
                                            <i class="bi bi-clipboard"></i>
                                        </button>
                                    </div>
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <small class="text-muted">Caractères: <span id="contextCharCount">0</span></small>
                                        <div>
                                            <small class="text-muted me-3">Mots: <span id="contextWordCount">0</span></small>
                                            <small class="text-muted">Paragraphes: <span id="contextParaCount">0</span></small>
                                        </div>
                                    </div>
                                </div>

                                <div class="textarea-container position-relative">
                                    <textarea id="inputText" class="form-control" rows="9" placeholder="Entrez votre texte ici..."></textarea>
                                    <button id="pasteInputText" class="btn paste-button" title="Coller">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted">Caractères: <span id="inputCharCount">0</span></small>
                                    <div>
                                        <small class="text-muted me-3">Mots: <span id="inputWordCount">0</span></small>
                                        <small class="text-muted">Paragraphes: <span id="inputParaCount">0</span></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <button id="reformulateBtn" class="btn btn-success w-100 mb-4">Reformuler</button>

                            <!-- Options Section -->
                            <div class="mb-4">
                                <div class="tag-section-header" id="optionsHeader">
                                    <h6 class="mb-0">
                                        <i class="bi bi-gear me-2"></i>
                                        Options
                                    </h6>
                                    <div class="d-flex align-items-center">
                                        <i class="bi bi-chevron-down toggle-icon"></i>
                                    </div>
                                </div>
                                <div class="collapsible-tag-section collapsed" id="optionsSection">
                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="useEmojis" value="true">
                                        <label class="form-check-label" for="useEmojis">
                                            Ajouter des emojis
                                        </label>
                                    </div>
                                    <hr class="my-3">
                                    <div class="options-grid">
                                        <!-- Tag sections (tone, format, length) -->
                                        <div class="options-section">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h6 class="mb-0">Ton</h6>
                                                <button class="btn btn-sm btn-outline-success add-tag-btn" data-target="toneGroup">
                                                    <i class="bi bi-plus-lg"></i>
                                                </button>
                                            </div>
                                            <div class="tag-container" id="toneGroup"></div>
                                        </div>

                                        <div class="options-section">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h6 class="mb-0">Format</h6>
                                                <button class="btn btn-sm btn-outline-success add-tag-btn" data-target="formatGroup">
                                                    <i class="bi bi-plus-lg"></i>
                                                </button>
                                            </div>
                                            <div class="tag-container" id="formatGroup"></div>
                                        </div>

                                        <div class="options-section">
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <h6 class="mb-0">Longueur</h6>
                                                <button class="btn btn-sm btn-outline-success add-tag-btn" data-target="lengthGroup">
                                                    <i class="bi bi-plus-lg"></i>
                                                </button>
                                            </div>
                                            <div class="tag-container" id="lengthGroup"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Removed Action Button -->
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="mb-3">Texte reformulé:</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="outputText" class="form-control mb-3" rows="18" readonly></textarea>
                                <div class="button-group position-absolute" style="top: 3px; right: 3px;">
                                    <button id="copyOutputText" class="btn copy-button" title="Copier">
                                        <i class="bi bi-files"></i>
                                    </button>
                                    <button id="clearBtn" class="btn copy-button" title="Effacer">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">Caractères: <span id="outputCharCount">0</span></small>
                                <div>
                                    <small class="text-muted me-3">Mots: <span id="outputWordCount">0</span></small>
                                    <small class="text-muted">Paragraphes: <span id="outputParaCount">0</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Translation Tab -->
        <div class="tab-pane fade" id="translation" role="tabpanel">
            <div class="row g-4">
                <!-- Translation Input Card -->
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="mb-3">Texte source</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="translationInput" class="form-control flex-grow-1" rows="5" placeholder="Entrez votre texte ici..."></textarea>
                                <button id="pasteTranslationText" class="btn paste-button" title="Coller">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>                            
                            <div class="d-flex justify-content-between align-items-center mt-2">
                                <small class="text-muted">Caractères: <span id="translationInputCharCount">0</span></small>
                                <div>
                                    <small class="text-muted me-3">Mots: <span id="translationInputWordCount">0</span></small>
                                    <small class="text-muted">Paragraphes: <span id="translationInputParaCount">0</span></small>
                                </div>
                            </div>

                            <!-- Translation Options -->
                            <div class="mt-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">Langue cible</h5>
                                </div>
                                <div class="language-buttons" id="languageButtons">
                                    <button class="btn btn-outline-success language-btn" data-lang="Anglais">
                                        <i class="bi bi-translate me-2"></i>Anglais
                                    </button>
                                    <button class="btn btn-outline-success language-btn" data-lang="Français">
                                        <i class="bi bi-translate me-2"></i>Français
                                    </button>
                                    <button class="btn btn-outline-success language-btn" data-lang="Espagnol">
                                        <i class="bi bi-translate me-2"></i>Espagnol
                                    </button>
                                    <button class="btn btn-outline-success language-btn" data-lang="Allemand">
                                        <i class="bi bi-translate me-2"></i>Allemand
                                    </button>
                                    <button class="btn btn-outline-success language-btn" data-lang="Italien">
                                        <i class="bi bi-translate me-2"></i>Italien
                                    </button>
                                    <button class="btn btn-outline-success language-btn" data-lang="Portugais">
                                        <i class="bi bi-translate me-2"></i>Portugais
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Translation Output Card -->
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-body d-flex flex-column">
                            <h5 class="mb-3">Traduction</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="translationOutput" class="form-control flex-grow-1 mb-3" rows="18" readonly></textarea>
                                <div class="button-group position-absolute" style="top: 3px; right: 3px;">
                                    <button id="copyTranslationOutput" class="btn copy-button" title="Copier">
                                        <i class="bi bi-files"></i>
                                    </button>
                                    <button id="clearTranslation" class="btn copy-button" title="Effacer">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>                            
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">Caractères: <span id="translationOutputCharCount">0</span></small>
                                <div>
                                    <small class="text-muted me-3">Mots: <span id="translationOutputWordCount">0</span></small>
                                    <small class="text-muted">Paragraphes: <span id="translationOutputParaCount">0</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Correcteur Tab -->
        <div class="tab-pane fade" id="correction" role="tabpanel">
            <div class="row g-4">
                <!-- Left Column -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <!-- Input Section -->
                            <div class="mb-4">
                                <h5 class="mb-3">Texte à corriger:</h5>
                                <div class="textarea-container position-relative">
                                    <textarea id="correctionInput" class="form-control" rows="10" placeholder="Collez votre texte ici pour correction..."></textarea>
                                    <button id="pasteCorrectionText" class="btn paste-button" title="Coller">
                                        <i class="bi bi-clipboard"></i>
                                    </button>
                                </div>                        
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <small class="text-muted">Caractères: <span id="correctionInputCharCount">0</span></small>
                                    <div>
                                        <small class="text-muted me-3">Mots: <span id="correctionInputWordCount">0</span></small>
                                        <small class="text-muted">Paragraphes: <span id="correctionInputParaCount">0</span></small>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Button -->
                            <button id="correctText" class="btn btn-success w-100 mb-4">Corriger</button>

                            <!-- Options Section -->
                            <div class="mb-4">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="mb-0">Options</h5>
                                    <button class="btn btn-link p-0 text-white" type="button" data-bs-toggle="collapse" data-bs-target="#correctionOptions">
                                        <i class="bi bi-chevron-down"></i>
                                    </button>
                                </div>
                                <div class="collapse" id="correctionOptions">
                                    <div class="card">
                                        <div class="card-body">
                                            <!-- Syntax Section -->
                                            <div class="col-12 mb-3">
                                                <div class="d-flex align-items-center mb-2">
                                                    <div class="form-check mb-0">
                                                        <input class="form-check-input" type="checkbox" id="checkSyntax" checked>
                                                        <label class="form-check-label h6 mb-0" for="checkSyntax">
                                                            Syntaxe
                                                        </label>
                                                    </div>
                                                    <button class="btn btn-sm btn-link text-white ms-2 syntax-toggle" type="button" data-bs-toggle="collapse" data-bs-target="#syntaxRules">
                                                        <i class="bi bi-chevron-down"></i>
                                                    </button>
                                                </div>
                                                <div class="collapse" id="syntaxRules">
                                                    <div class="card card-body bg-dark">
                                                        <div class="row g-2">
                                                            <div class="col-md-6">
                                                                <div class="form-check">
                                                                    <input class="form-check-input syntax-rule" type="checkbox" id="wordOrder" checked>
                                                                    <label class="form-check-label" for="wordOrder">
                                                                        Ordre des mots
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input syntax-rule" type="checkbox" id="subjectVerb" checked>
                                                                    <label class="form-check-label" for="subjectVerb">
                                                                        Accord sujet-verbe
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input syntax-rule" type="checkbox" id="verbTense" checked>
                                                                    <label class="form-check-label" for="verbTense">
                                                                        Temps verbaux
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-6">
                                                                <div class="form-check">
                                                                    <input class="form-check-input syntax-rule" type="checkbox" id="genderNumber" checked>
                                                                    <label class="form-check-label" for="genderNumber">
                                                                        Accord en genre et nombre
                                                                    </label>
                                                                </div>
                                                                <div class="form-check">
                                                                    <input class="form-check-input syntax-rule" type="checkbox" id="relativePronouns" checked>
                                                                    <label class="form-check-label" for="relativePronouns">
                                                                        Pronoms relatifs
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Other Options -->
                                            <div class="row">
                                                <div class="col-md-6">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="checkGrammar" checked>
                                                        <label class="form-check-label" for="checkGrammar">
                                                            Grammaire
                                                        </label>
                                                    </div>
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="checkSpelling" checked>
                                                        <label class="form-check-label" for="checkSpelling">
                                                            Orthographe
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="checkStyle" checked>
                                                        <label class="form-check-label" for="checkStyle">
                                                            Style
                                                        </label>
                                                    </div>
                                                </div>
                                                <div class="col-md-6">
                                                    <div class="form-check mb-2">
                                                        <input class="form-check-input" type="checkbox" id="checkPunctuation" checked>
                                                        <label class="form-check-label" for="checkPunctuation">
                                                            Ponctuation
                                                        </label>
                                                    </div>
                                                    <div class="form-check">
                                                        <input class="form-check-input" type="checkbox" id="checkSynonyms">
                                                        <label class="form-check-label" for="checkSynonyms">
                                                            Suggestions de synonymes
                                                        </label>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Removed Action Button -->
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="mb-3">Texte corrigé:</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="correctionOutput" class="form-control mb-3" rows="18" readonly></textarea>
                                <div class="button-group position-absolute" style="top: 3px; right: 3px;">
                                    <button id="copyCorrectionOutput" class="btn copy-button" title="Copier">
                                        <i class="bi bi-files"></i>
                                    </button>
                                    <button id="clearCorrection" class="btn copy-button" title="Effacer">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>                        
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <small class="text-muted">Caractères: <span id="correctionOutputCharCount">0</span></small>
                                <div>
                                    <small class="text-muted me-3">Mots: <span id="correctionOutputWordCount">0</span></small>
                                    <small class="text-muted">Paragraphes: <span id="correctionOutputParaCount">0</span></small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div class="tab-pane fade" id="config" role="tabpanel">
            <div class="card mb-4">
                <div class="card-body">
                    <div class="mb-4">
                        <label class="form-label">Fournisseur d'IA:</label>
                        <select id="aiProvider" class="form-select">
                            <option value="ollama">Ollama (Local)</option>
                            <option value="openai">OpenAI</option>
                            <option value="anthropic">Anthropic</option>
                            <option value="gemini">Google Gemini</option>
                            <option value="groq">Groq</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="openrouter">Openrouter</option>
                        </select>
                    </div>

                    <!-- Provider-specific configurations -->
                    <div id="ollamaConfig" class="provider-config mb-4">
                        <label class="form-label">URL d'Ollama:</label>
                        <input type="text" id="ollamaUrl" class="form-control mb-3" placeholder="http://localhost:11434">
                        <label class="form-label">Modèle:</label>
                        <select id="modelSelect" class="form-select mb-3"></select>
                        <button id="refreshModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="openaiConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API OpenAI:</label>
                        <input type="password" id="openaiKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="openaiModel" class="form-select mb-3"></select>
                        <button id="refreshOpenaiModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="anthropicConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API Anthropic:</label>
                        <input type="password" id="anthropicKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="anthropicModel" class="form-select mb-3"></select>
                        <button id="refreshAnthropicModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="geminiConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API Google:</label>
                        <input type="password" id="geminiKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="geminiModel" class="form-select mb-3"></select>
                        <button id="refreshGeminiModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="groqConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API Groq:</label>
                        <input type="password" id="groqKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="groqModel" class="form-select mb-3"></select>
                        <button id="refreshGroqModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="deepseekConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API Deepseek:</label>
                        <input type="password" id="deepseekKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="deepseekModel" class="form-select mb-3"></select>
                        <button id="refreshDeepseekModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>

                    <div id="openrouterConfig" class="provider-config mb-4" style="display: none;">
                        <label class="form-label">Clé API Openrouter:</label>
                        <input type="password" id="openrouterKey" class="form-control mb-3">
                        <label class="form-label">Modèle:</label>
                        <select id="openrouterModel" class="form-select mb-3"></select>
                        <button id="refreshopenrouterModels" class="btn btn-success w-100">Rafraîchir les modèles</button>
                    </div>
                    <!-- Prompts configuration -->
                    <div class="mb-4">
                        <div class="tag-section-header mb-2" id="systemPromptHeader">
                            <h6 class="mb-0">
                                <i class="bi bi-gear me-2"></i>
                                Prompt système
                            </h6>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-down toggle-icon collapsed"></i>
                            </div>
                        </div>
                        <div class="collapsible-tag-section collapsed" id="systemPromptSection">
                            <textarea id="systemPrompt" class="form-control" rows="5">{{ system_prompt }}</textarea>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="tag-section-header mb-2" id="translationPromptHeader">
                            <h6 class="mb-0">
                                <i class="bi bi-translate me-2"></i>
                                Prompt de traduction
                            </h6>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-down toggle-icon collapsed"></i>
                            </div>
                        </div>
                        <div class="collapsible-tag-section collapsed" id="translationPromptSection">
                            <textarea id="translationPrompt" class="form-control" rows="5">{{ translation_prompt }}</textarea>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="tag-section-header mb-2" id="correctionPromptHeader">
                            <h6 class="mb-0">
                                <i class="bi bi-check2-square me-2"></i>
                                Prompt du correcteur
                            </h6>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-down toggle-icon collapsed"></i>
                            </div>
                        </div>
                        <div class="collapsible-tag-section collapsed" id="correctionPromptSection">
                            <textarea id="correctionPrompt" class="form-control" rows="5">{{ correction_prompt }}</textarea>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="tag-section-header mb-2" id="emailPromptHeader">
                            <h6 class="mb-0">
                                <i class="bi bi-envelope me-2"></i>
                                Prompt du générateur d'email
                            </h6>
                            <div class="d-flex align-items-center">
                                <i class="bi bi-chevron-down toggle-icon collapsed"></i>
                            </div>
                        </div>
                        <div class="collapsible-tag-section collapsed" id="emailPromptSection">
                            <textarea id="emailPrompt" class="form-control" rows="5">{{ email_prompt }}</textarea>
                        </div>
                    </div>

                    <button id="saveConfig" class="btn btn-success w-100">Enregistrer</button>
                </div>
            </div>
        </div>

        <!-- Email Generator Tab -->
        <div class="tab-pane fade" id="email" role="tabpanel">
            <div class="row g-4">
                <!-- Left Block - Input Fields -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="mb-3">Type d'email:</h5>
                            <div class="textarea-container position-relative">
                                <input type="text" id="emailType" class="form-control mb-4" placeholder="Ex: Email de réclamation, Demande de congés...">
                                <button id="pasteEmailType" class="btn paste-button" title="Coller">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>                            
                            <h5 class="mb-3">Contenu et contexte:</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="emailContent" class="form-control mb-4" rows="4" placeholder="Décrivez le contenu et le contexte de l'email que vous souhaitez générer..."></textarea>
                                <button id="pasteEmailContent" class="btn paste-button" title="Coller">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>                            
                            <h5 class="mb-3">Prénom NOM:</h5>
                            <div class="textarea-container position-relative">
                                <input type="text" id="emailSender" class="form-control mb-4" placeholder="Ex: Jean DUPONT">
                                <button id="pasteEmailSender" class="btn paste-button" title="Coller">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                            <div class="mb-4">
                                <div class="tag-section-header" id="emailToneHeader">
                                    <h6 class="mb-0">
                                        <i class="bi bi-chat-right-quote me-2"></i>
                                        Ton de l'email
                                    </h6>
                                    <div class="d-flex align-items-center gap-2">
                                        <button class="btn btn-sm btn-outline-success add-tag-btn" data-target="emailToneGroup" title="Ajouter un ton">
                                            <i class="bi bi-plus-lg"></i>
                                        </button>
                                        <i class="bi bi-chevron-down toggle-icon"></i>
                                    </div>
                                </div>
                                <div class="collapsible-tag-section collapsed" id="emailToneSection">
                                    <div class="tag-container position-relative" id="emailToneGroup">
                                        <span class="tag active" data-value="Professionnel">
                                            <i class="bi bi-briefcase me-1"></i>
                                            Professionnel
                                            <i class="bi bi-x tag-remove"></i>
                                        </span>
                                        <span class="tag" data-value="Informatif">
                                            <i class="bi bi-info-circle me-1"></i>
                                            Informatif
                                            <i class="bi bi-x tag-remove"></i>
                                        </span>
                                        <span class="tag" data-value="Cordial">
                                            <i class="bi bi-heart me-1"></i>
                                            Cordial
                                            <i class="bi bi-x tag-remove"></i>
                                        </span>
                                    </div>
                                </div>
                            </div>
                            <button id="generateEmail" class="btn btn-success w-100">Générer l'email</button>
                        </div>
                    </div>
                </div>
                
                <!-- Right Block - Generated Email -->
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="mb-3">Objet:</h5>
                            <div class="textarea-container position-relative">
                                <input type="text" id="emailSubject" class="form-control" readonly>
                                <button id="copySubject" class="btn copy-button" type="button" title="Copier l'objet">
                                    <i class="bi bi-files"></i>
                                </button>
                            </div>
                            <br>
                            <h5 class="mb-3">Email généré:</h5>
                            <div class="textarea-container position-relative">
                                <textarea id="emailOutput" class="form-control mb-4" rows="15" readonly></textarea>
                                <div class="button-group position-absolute" style="top: 3px; right: 3px;">
                                    <button id="copyEmailOutput" class="btn copy-button" title="Copier">
                                        <i class="bi bi-files"></i>
                                    </button>
                                    <button id="clearEmail" class="btn copy-button" title="Effacer">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- History Tab -->
        <div class="tab-pane fade" id="history" role="tabpanel">
            <div class="accordion" id="historyAccordion">
                <!-- Reformulation History -->
                <div class="accordion-item mb-4">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#reformulationHistory">
                            Historique des reformulations
                        </button>
                    </h2>
                    <div id="reformulationHistory" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            {% if reformulation_history %}
                                <div class="list-group">
                                    {% for entry in reformulation_history %}
                                    <div class="list-group-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <small class="text-muted">{{ entry.created_at }}</small>
                                            <button class="btn btn-sm btn-success reuse-history"
                                                data-context="{{ entry.context }}"
                                                data-text="{{ entry.original_text }}"
                                                data-tone="{{ entry.tone }}"
                                                data-format="{{ entry.format }}"
                                                data-length="{{ entry.length }}">
                                                Réutiliser
                                            </button>
                                        </div>
                                        <div class="mb-2">
                                            <strong>Original:</strong>
                                            <pre class="mb-2">{{ entry.original_text }}</pre>
                                            {% if entry.context %}
                                            <strong>Contexte:</strong>
                                            <pre class="mb-2">{{ entry.context }}</pre>
                                            {% endif %}
                                            <strong>Reformulation:</strong>
                                            <pre>{{ entry.reformulated_text }}</pre>
                                        </div>
                                        <div>
                                            <span class="badge bg-secondary me-1">{{ entry.tone }}</span>
                                            <span class="badge bg-secondary me-1">{{ entry.format }}</span>
                                            <span class="badge bg-secondary">{{ entry.length }}</span>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted">Aucun historique de reformulation</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Email History -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#emailHistory">
                            Historique des emails
                        </button>
                    </h2>
                    <div id="emailHistory" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            {% if email_history %}
                                <div class="list-group">
                                    {% for entry in email_history %}
                                    <div class="list-group-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <small class="text-muted">{{ entry.created_at }}</small>
                                            <button class="btn btn-sm btn-success reuse-email"
                                                data-type="{{ entry.email_type }}"
                                                data-content="{{ entry.content }}"
                                                data-sender="{{ entry.sender }}">
                                                Réutiliser
                                            </button>
                                        </div>
                                        <div>
                                            <strong>Type:</strong> {{ entry.email_type }}<br>
                                            {% if entry.sender %}
                                            <strong>Expéditeur:</strong> {{ entry.sender }}<br>
                                            {% endif %}
                                            <strong>Contenu:</strong>
                                            <pre class="mb-2">{{ entry.content }}</pre>
                                            <strong>Email généré:</strong>
                                            <pre>{{ entry.generated_email }}</pre>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted">Aucun historique d'email</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Correction History -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#correctionHistory">
                            Historique des corrections
                        </button>
                    </h2>
                    <div id="correctionHistory" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            {% if correction_history %}
                                <div class="list-group">
                                    {% for entry in correction_history %}
                                    <div class="list-group-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <small class="text-muted">{{ entry.created_at }}</small>
                                            <button class="btn btn-sm btn-success reuse-correction"
                                                data-text="{{ entry.original_text }}"
                                                data-corrections='{{ entry.corrections|tojson|safe }}'
                                                data-type="correction">
                                                Réutiliser
                                            </button>
                                        </div>
                                        <div class="mb-2">
                                            <strong>Texte original:</strong>
                                            <pre class="mb-2">{{ entry.original_text }}</pre>
                                            <strong>Texte corrigé:</strong>
                                            <pre>{{ entry.corrected_text }}</pre>
                                        </div>
                                        <div>
                                            <strong>Corrections appliquées:</strong>
                                            <ul class="list-unstyled">
                                            {% for type, details in entry.corrections.items() %}
                                                <li><span class="badge bg-info">{{ type }}</span> {{ details }}</li>
                                            {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted">Aucun historique de correction</p>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Translation History -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#translationHistory">
                            Historique des traductions
                        </button>
                    </h2>
                    <div id="translationHistory" class="accordion-collapse collapse">
                        <div class="accordion-body">
                            {% if translation_history %}
                                <div class="list-group">
                                    {% for entry in translation_history %}
                                    <div class="list-group-item">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <small class="text-muted">{{ entry.created_at }}</small>
                                            <button class="btn btn-sm btn-success reuse-translation"
                                                data-text="{{ entry.original_text }}"
                                                data-target-language="{{ entry.target_language }}">
                                                Réutiliser
                                            </button>
                                        </div>
                                        <div class="mb-2">
                                            <strong>Texte original:</strong>
                                            <pre class="mb-2">{{ entry.original_text }}</pre>
                                            <strong>Traduction ({{ entry.target_language }}):</strong>
                                            <pre>{{ entry.translated_text }}</pre>
                                        </div>
                                        {% if entry.source_language %}
                                        <div>
                                            <span class="badge bg-secondary">{{ entry.source_language }} ➔ {{ entry.target_language }}</span>
                                        </div>
                                        {% endif %}
                                    </div>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <p class="text-muted">Aucun historique de traduction</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
                </div>

            <button id="resetHistory" class="btn btn-danger w-100 mt-4">Réinitialiser l'historique</button>
        </div>
    </div>
</div>

{% include 'translation_modal.html' %}
{% include 'settings_modal.html' %}
{% endblock %}